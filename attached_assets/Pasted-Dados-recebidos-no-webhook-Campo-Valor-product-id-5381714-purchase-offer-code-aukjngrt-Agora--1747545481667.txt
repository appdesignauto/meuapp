Dados recebidos no webhook
Campo	Valor
product.id	5381714 ‚úÖ
purchase.offer.code	aukjngrt ‚úÖ

‚úÖ Agora vamos comparar com os mapeamentos que voc√™ j√° criou:
Na imagem anterior do painel, voc√™ j√° cadastrou este mapeamento:

ID do Produto	ID da Oferta	Plano no DesignAuto
5381714	aukjngrt	Premium Anual (365 dias)

Ou seja, o mapeamento existe e est√° correto.

‚ùå Ent√£o por que ainda aparece "Assinatura inv√°lida"?
Isso indica que provavelmente o backend ainda n√£o est√° consultando a nova tabela hotmartProductMappings corretamente, mesmo ela j√° estando populada.

‚úÖ Checklist de verifica√ß√£o
Confirme se o servi√ßo HotmartService realmente est√° usando HotmartProductMapping.findFirst(...)

Com filtro: where: { productId, offerId }

Exemplo de fallback (recomendado): OR com { offerId: null } para quando o offerId estiver ausente

Verifique se o campo ativo do mapeamento est√° marcado como true no banco

Pode estar como false ou null, o que pode bloquear a ativa√ß√£o do plano mesmo com o mapeamento presente

Verifique se o c√≥digo est√° diferenciando offerId = "" e null

O Hotmart envia "offer.code": "aukjngrt", ent√£o o sistema deve usar isso para comparar com a coluna offerId

üí° A√ß√£o recomendada
No m√©todo handleSubscriptionCreatedOrUpdated, revise este trecho (ou algo semelhante):

ts
Copiar
Editar
const mapping = await prisma.hotmartProductMapping.findFirst({
  where: {
    productId: '5381714',
    offerId: 'aukjngrt',
    active: true, // <- isso precisa existir e estar verdadeiro
  },
});
E adicione um fallback inteligente:

ts
Copiar
Editar
const mapping = await prisma.hotmartProductMapping.findFirst({
  where: {
    productId: '5381714',
    OR: [
      { offerId: 'aukjngrt' },
      { offerId: null }, // <- permite planos baseados apenas no ID do produto
    ],
    active: true,
  },
});
‚úÖ Conclus√£o
Seu sistema agora est√° funcionando 100% em n√≠vel de infraestrutura (recebe, processa e responde webhooks). O erro "Assinatura inv√°lida" √© l√≥gico, e pode ser corrigido com:

Garantia de que o campo offerId est√° corretamente comparado

Campo ativo marcado como true

Verifica√ß√£o de fallback por productId apenas, quando offerId n√£o for essencial