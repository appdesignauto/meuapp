âœ… FLUXO DE INTEGRAÃ‡ÃƒO HOTMART - DESIGNAUTO (PRODUÃ‡ÃƒO)
ğŸ¯ Objetivo:
Receber webhooks da Hotmart automaticamente e criar usuÃ¡rios com acesso premium vinculados a uma assinatura no banco de dados.

ğŸ”§ Estrutura TÃ©cnica Implementada
âœ… 1. Endpoint principal do Webhook
URL: /webhook/hotmart-fixed

Arquivo: server/routes/webhook-hotmart-fixed.ts

MÃ©todo: POST

ExecuÃ§Ã£o: InstantÃ¢nea (sem setTimeout)

âš™ï¸ 2. Fluxo do Webhook
ğŸš¨ ValidaÃ§Ã£o:
ts
Copiar
Editar
event === 'PURCHASE_APPROVED' && purchase.status === 'APPROVED'
ğŸ§¾ ExtraÃ§Ã£o:
buyer.name, buyer.email, buyer.document

purchase.transaction, order_date, date_next_charge

subscription.plan.name

ğŸ‘¤ CriaÃ§Ã£o de UsuÃ¡rio:
sql
Copiar
Editar
INSERT INTO users (
  username, email, name, password, nivelacesso, 
  origemassinatura, tipoplano, dataassinatura, 
  dataexpiracao, acessovitalicio, isactive, emailconfirmed
)
ğŸ” Registro de Assinatura:
sql
Copiar
Editar
INSERT INTO subscriptions (
  userId, planType, startDate, endDate, 
  isActive, transactionId, source
)
âœ… ValidaÃ§Ãµes Implementadas
Evento vÃ¡lido (PURCHASE_APPROVED)

Status de compra (APPROVED)

Campos obrigatÃ³rios presentes (email, name)

Duplicidade de transactionId evitada

ğŸ”§ Componentes Envolvidos
ğŸ“ Arquivos:
server/routes/webhook-hotmart-fixed.ts

server/index.ts com:

ts
Copiar
Editar
app.use('/webhook', webhookHotmartFixedRoutes);
ğŸ—ƒï¸ Estrutura no banco:
Tabela users: com campos como email, nivelacesso, tipoplano, dataassinatura, etc.

Tabela subscriptions: com transactionId, startDate, source, isActive

ğŸ§± Pontos CrÃ­ticos Resolvidos
Problema	SoluÃ§Ã£o aplicada
require is not defined	SubstituiÃ§Ã£o por senha temporÃ¡ria simples
0NaN-NaN-NaN em datas	Uso de new Date() + manipulaÃ§Ã£o segura de ms
Erro por setTimeout	ExecuÃ§Ã£o sÃ­ncrona na rota
Formatos diferentes de payload	ValidaÃ§Ã£o dinÃ¢mica e segura

ğŸŒ ConfiguraÃ§Ã£o na Hotmart
URL cadastrada no produto:
https://designauto.com.br/webhook/hotmart-fixed

Webhook configurado para evento: PURCHASE_APPROVED

âœ… Resultado final:
ğŸ”’ AutomaÃ§Ã£o 100% funcional

âš™ï¸ Zero intervenÃ§Ã£o manual

ğŸ‘¥ CriaÃ§Ã£o instantÃ¢nea de usuÃ¡rios

â­ Acesso premium liberado com base no plano

ğŸ§  Estrutura escalÃ¡vel e replicÃ¡vel para outros projetos